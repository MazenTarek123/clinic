import streamlit as st

# -------------------- Hide Streamlit default UI --------------------
hide_streamlit_elements = """
<style>
    header {visibility: hidden !important;}
    #MainMenu {visibility: hidden !important;}
    footer {visibility: hidden !important;}
    .block-container {padding-top: 0rem !important; padding-bottom: 0rem !important;}
</style>
"""
st.markdown(hide_streamlit_elements, unsafe_allow_html=True)

st.set_page_config(
    page_title="Cure & Go | Doctor Portal",
    page_icon="ğŸ‘¨â€âš•ï¸",
    layout="wide"
)

# -------------------- Style --------------------
st.markdown("""
<style>
.stApp {background: linear-gradient(135deg, #f5f7fa, #c3cfe2); font-family: 'Segoe UI', sans-serif;}
h1 {text-align:center; color:#1f2937;}
.stButton>button {border-radius:14px; padding:12px; background: linear-gradient(90deg,#2563eb,#1d4ed8); color:white; font-weight:bold; border:none; transition:0.3s;}
.stButton>button:hover {transform: scale(1.06);}
</style>
""", unsafe_allow_html=True)

# -------------------- Doctor Class --------------------
class Doctor:
    def __init__(self, doctor_id, name, specialization):
        self.doctor_id = doctor_id
        self.name = name
        self.specialization = specialization
        # Ø¬Ø¯ÙˆÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø£ÙŠØ§Ù… (0-23 Ø³Ø§Ø¹Ø§Øª)
        self.schedule = {day: ["available"]*24 for day in ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}

# -------------------- Sample Data --------------------
if "doctors" not in st.session_state:
    st.session_state.doctors = [
        Doctor("001", "Haneen El-Barbary", "Psychotherapy"),
        Doctor("002", "Haneen Ayman", "Pediatrics"),
        Doctor("003", "Menna Ayman", "Dermatology"),
        Doctor("004", "Sohaila Gomaa", "ENT"),
        Doctor("005", "Nour Omar", "Nutrition"),
        Doctor("006", "Haneen El Azab", "Cardiology"),
        Doctor("007", "Mostafa Hatem", "Orthopedics"),
        Doctor("008", "Mazen Tarek", "Neurology"),
    ]

if "appointments" not in st.session_state:
    st.session_state.appointments = [
        {"doctor_id":"001","patient_name":"Ali","patient_phone":"01011111111","day":"Monday","hour":10},
        {"doctor_id":"003","patient_name":"Sara","patient_phone":"01033333333","day":"Tuesday","hour":14},
        {"doctor_id":"007","patient_name":"Omar","patient_phone":"01077777777","day":"Friday","hour":9},
    ]

if "logged_in_doctor" not in st.session_state:
    st.session_state.logged_in_doctor = None

# -------------------- Doctor Login --------------------
def doctor_login():
    st.header("ğŸ‘¨â€âš•ï¸ Doctor Portal Login")
    doc_id = st.text_input("Enter Doctor ID (3 digits)")
    if st.button("Login"):
        if len(doc_id)==3 and doc_id.isdigit():
            doctor = next((d for d in st.session_state.doctors if d.doctor_id==doc_id), None)
            if doctor:
                st.session_state.logged_in_doctor = doctor
                st.success(f"Welcome, Dr. {doctor.name}!")
                st.experimental_rerun()
            else:
                st.error("Doctor ID not found.")
        else:
            st.error("Invalid ID. Must be 3 digits.")

# -------------------- Doctor Dashboard --------------------
def doctor_dashboard():
    doctor = st.session_state.logged_in_doctor
    st.sidebar.title(f"Dr. {doctor.name}")
    st.sidebar.write(f"**Specialization:** {doctor.specialization}")
    menu = st.sidebar.radio("Navigation", ["ğŸ“… My Appointments", "âš™ï¸ Manage Availability", "ğŸšª Logout"])
    
    if menu == "ğŸ“… My Appointments":
        st.subheader("My Scheduled Appointments")
        my_appts = [a for a in st.session_state.appointments if a["doctor_id"]==doctor.doctor_id]
        if my_appts:
            display = [{"Patient": a["patient_name"], "Phone": a["patient_phone"], "Day": a["day"], "Hour": f"{a['hour']}:00"} for a in my_appts]
            st.table(display)
        else:
            st.info("No upcoming appointments.")
    
    elif menu == "âš™ï¸ Manage Availability":
        st.subheader("Edit Work Schedule")
        day = st.selectbox("Select Day", list(doctor.schedule.keys()))
        hours = doctor.schedule[day]
        col1, col2, col3 = st.columns(3)
        for i in range(24):
            status = hours[i]
            btn_label = f"{i:02d}:00 - {'âœ… Open' if status=='available' else 'â›” Closed'}"
            col = col1 if i<8 else col2 if i<16 else col3
            with col:
                if st.button(btn_label, key=f"{day}_{i}"):
                    hours[i] = "not available" if status=="available" else "available"
                    st.toast(f"Updated {i:02d}:00 to {hours[i]}")
                    st.experimental_rerun()
    
    elif menu == "ğŸšª Logout":
        st.session_state.logged_in_doctor = None
        st.experimental_rerun()

# -------------------- Main --------------------
if st.session_state.logged_in_doctor is None:
    doctor_login()
else:
    doctor_dashboard()
