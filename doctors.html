import streamlit as st

# 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙˆÙ„ Ø³Ø·Ø±)
st.set_page_config(page_title="Cure & Go | Doctor Portal", page_icon="ğŸ‘¨â€âš•ï¸", layout="wide")

# --- ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙƒÙ„Ø§Ø³ Ù„Ø¶Ù…Ø§Ù† ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
class Doctor:
    def __init__(self, doctor_id, name, specialization):
        self.doctor_id = doctor_id
        self.name = name
        self.specialization = specialization
        # Ø¬Ø¯ÙˆÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ: 7 Ø£ÙŠØ§Ù… ÙˆÙƒÙ„ ÙŠÙˆÙ… 24 Ø³Ø§Ø¹Ø©
        self.schedule = {day: ["available"] * 24 for day in ["Saturday", "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]}

# --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Session State) ---
# Ù…Ù„Ø§Ø­Ø¸Ø©: ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ£ØªÙŠ Ù…Ù† Ù…Ù„ÙÙƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
if 'all_doctors' not in st.session_state:
    st.session_state['all_doctors'] = [
        Doctor("001", "Haneen El-Barbary", "Psychotherapy"),
        Doctor("006", "Haneen El Azab", "Cardiology")
    ]

if 'appointments' not in st.session_state:
    st.session_state['appointments'] = []

# --- Ø¯Ø§Ù„Ø© Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ± ---
def doctor_function():
    st.header("ğŸ‘¨â€âš•ï¸ Doctor Portal")
    
    # --- 1. Login Logic ---
    if st.session_state.get('logged_in_doctor') is None:
        st.subheader("Login")
        with st.form("doctor_login_form"):
            doc_id_input = st.text_input("Enter Doctor ID (3 digits)", max_chars=3)
            submitted = st.form_submit_button("Login")

            if submitted:
                if len(doc_id_input) == 3 and doc_id_input.isdigit():
                    found_doc = next((doc for doc in st.session_state['all_doctors'] if doc.doctor_id == doc_id_input), None)
                    
                    if found_doc:
                        st.session_state['logged_in_doctor'] = found_doc
                        st.success(f"Welcome, Dr. {found_doc.name}!")
                        st.rerun() 
                    else:
                        st.error("Access Denied: Doctor ID not found.")
                else:
                    st.error("Invalid ID format. Must be exactly 3 digits.")
        return 

    # --- 2. Dashboard Logic ---
    current_doc = st.session_state['logged_in_doctor']
    
    with st.sidebar:
        st.title(f"Dr. {current_doc.name}")
        st.write(f"**Specialization:** {current_doc.specialization}")
        st.write("---")
        menu = st.radio("Navigation", ["ğŸ“… My Appointments", "âš™ï¸ Manage Availability", "ğŸšª Logout"])

    if menu == "ğŸ“… My Appointments":
        st.subheader("My Scheduled Appointments")
        all_appointments = st.session_state.get('appointments', [])
        my_appointments = [appt for appt in all_appointments if appt['doctor_id'] == current_doc.doctor_id]

        if my_appointments:
            st.table(my_appointments)
        else:
            st.info("You have no upcoming appointments.")

    elif menu == "âš™ï¸ Manage Availability":
        st.subheader("Edit Work Schedule")
        selected_day = st.selectbox("Select Day to Edit", list(current_doc.schedule.keys()))
        
        st.info("Note: You cannot close hours that are already 'Booked'.")
        
        col1, col2, col3 = st.columns(3)
        current_schedule = current_doc.schedule[selected_day]
        
        for i in range(24):
            status = current_schedule[i]
            hour_label = f"{i:02d}:00"
            if i < 8: col = col1
            elif i < 16: col = col2
            else: col = col3
            
            with col:
                if status == "booked":
                    st.warning(f"ğŸ•’ {hour_label}: ğŸ”’ BOOKED")
                else:
                    is_available = (status == "available")
                    btn_label = f"ğŸ•’ {hour_label}: {'âœ… Open' if is_available else 'â›” Closed'}"
                    if st.button(btn_label, key=f"btn_{selected_day}_{i}"):
                        current_doc.schedule[selected_day][i] = "not available" if is_available else "available"
                        st.rerun()

    elif menu == "ğŸšª Logout":
        st.session_state['logged_in_doctor'] = None
        st.rerun()

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø©
if __name__ == "__main__":
    doctor_function()
