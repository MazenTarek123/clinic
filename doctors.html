import streamlit as st

# 1. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ù‡Ùˆ Ø£ÙˆÙ„ Ø³Ø·Ø± Ø¨Ø±Ù…Ø¬ÙŠ ØªÙ…Ø§Ù…Ø§Ù‹
st.set_page_config(page_title="Cure & Go | Doctor Portal", page_icon="ğŸ‘¨â€âš•ï¸", layout="wide")

# --- ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙƒÙ„Ø§Ø³ Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ‚Ù„ ---
class Doctor:
    def __init__(self, doctor_id, name, specialization):
        self.doctor_id = doctor_id
        self.name = name
        self.specialization = specialization
        # Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ
        self.schedule = {day: ["available"] * 24 for day in ["Saturday", "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]}

# --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Session State) ---
if "doctors" not in st.session_state:
    st.session_state.doctors = [
        Doctor("001", "Haneen El-Barbary", "Psychotherapy"),
        Doctor("006", "Haneen El Azab", "Cardiology"),
        Doctor("007", "Mostafa Hatem", "Orthopedics")
    ]

if "appointments" not in st.session_state:
    # Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ø¹ÙŠØ¯ ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©
    st.session_state.appointments = [
        {"doctor_id": "001", "patient_name": "Ahmed Aly", "patient_phone": "0123456789", "day": "Monday", "hour": 10},
        {"doctor_id": "001", "patient_name": "Sara Kamel", "patient_phone": "0111222333", "day": "Monday", "hour": 14}
    ]

# --- ØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙØ­Ø© CSS ---
st.markdown("""
<style>
    .stApp { background: linear-gradient(135deg, #f5f7fa, #c3cfe2); }
    .login-box { background-color: white; padding: 30px; border-radius: 15px; box-shadow: 0px 4px 15px rgba(0,0,0,0.1); }
    h1 { color: #1f2937; text-align: center; }
</style>
""", unsafe_allow_html=True)

# ---------------------------------------------------------
# Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Øµ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
# ---------------------------------------------------------
if 'logged_in_doctor_id' not in st.session_state or st.session_state['logged_in_doctor_id'] is None:
    st.markdown("<br><br>", unsafe_allow_html=True)
    col1, col2, col3 = st.columns([1, 1.5, 1])
    
    with col2:
        st.markdown("<h1>ğŸ‘¨â€âš•ï¸ Doctor Login</h1>", unsafe_allow_html=True)
        with st.container():
            doc_id_input = st.text_input("Enter your 3-digit ID", placeholder="e.g. 001")
            if st.button("Login to Dashboard", use_container_width=True):
                found_doc = next((d for d in st.session_state.doctors if d.doctor_id == doc_id_input), None)
                if found_doc:
                    st.session_state['logged_in_doctor_id'] = found_doc.doctor_id
                    st.success(f"Welcome Dr. {found_doc.name}")
                    st.rerun()
                else:
                    st.error("ID not found. Try 001")
    st.stop() # ØªÙˆÙ‚Ù Ù‡Ù†Ø§ Ø­ØªÙ‰ ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„

# ---------------------------------------------------------
# Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Øµ Ø¨Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ø¨ÙŠØ¨ (ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„)
# ---------------------------------------------------------
current_doc = next(d for d in st.session_state.doctors if d.doctor_id == st.session_state['logged_in_doctor_id'])

# Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
with st.sidebar:
    st.title(f"Dr. {current_doc.name}")
    st.write(f"**Specialty:** {current_doc.specialization}")
    st.write("---")
    menu = st.radio("Navigation", ["ğŸ“… My Appointments", "âš™ï¸ Manage Schedule", "ğŸšª Logout"])

# 1. Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
if menu == "ğŸ“… My Appointments":
    st.header("My Appointments")
    my_appts = [a for a in st.session_state.appointments if a['doctor_id'] == current_doc.doctor_id]
    
    if my_appts:
        st.table(my_appts)
    else:
        st.info("No appointments scheduled.")

# 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
elif menu == "âš™ï¸ Manage Schedule":
    st.header("Work Schedule")
    day = st.selectbox("Select Day", list(current_doc.schedule.keys()))
    
    cols = st.columns(4)
    for i in range(24):
        status = current_doc.schedule[day][i]
        btn_label = f"{i:02d}:00 - {status}"
        with cols[i % 4]:
            if st.button(btn_label, key=f"btn_{i}"):
                current_doc.schedule[day][i] = "not available" if status == "available" else "available"
                st.rerun()

# 3. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
elif menu == "ğŸšª Logout":
    st.session_state['logged_in_doctor_id'] = None
    st.rerun()
