import streamlit as st

# 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙˆÙ„ Ø£Ù…Ø± ÙÙŠ Streamlit)
st.set_page_config(page_title="Cure & Go | Doctor Portal", page_icon="ğŸ‘¨â€âš•ï¸", layout="wide")

# --- ØªØ¹Ø±ÙŠÙ ÙƒÙ„Ø§Ø³ Ø§Ù„Ø·Ø¨ÙŠØ¨ (Ù„Ø£Ù†Ù‡ ØºÙŠØ± Ù…Ø¹Ø±Ù ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ù†ÙØµÙ„) ---
class Doctor:
    def __init__(self, doctor_id, name, gender, phone, age, exp, spec, room, price):
        self.doctor_id = doctor_id
        self.name = name
        self.gender = gender
        self.phone = phone
        self.age = age
        self.exp = exp
        self.specialization = spec
        self.room = room
        self.price = price
        self.schedule = {day: ["available"] * 24 for day in ["Saturday", "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]}

# --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Default Data) Ù„ÙƒÙŠ Ù„Ø§ ØªØ¸Ù‡Ø± Ø§Ù„ØµÙØ­Ø© ÙØ§Ø±ØºØ© ---
if "doctors" not in st.session_state:
    st.session_state.doctors = [
        Doctor("001", "Haneen El-Barbary", "Female", "01500111111", 27, 2, "Psychotherapy", 1, 250),
        Doctor("006", "Haneen El Azab", "Female", "01000666666", 25, 1, "Cardiology", 6, 350),
        Doctor("007", "Mostafa Hatem", "Male", "01000777777", 30, 4, "Orthopedics", 7, 300),
    ]

if "appointments" not in st.session_state:
    st.session_state.appointments = []

# --- Ø§Ù„ØªØµÙ…ÙŠÙ… CSS ---
st.markdown("""
<style>
.stApp { background: linear-gradient(135deg, #f5f7fa, #c3cfe2); font-family: 'Segoe UI', sans-serif; }
.main-title { font-size: 42px; font-weight: 800; text-align: center; color: #1f2937; margin-bottom: 30px; }
</style>
""", unsafe_allow_html=True)

# --- Ù…Ù†Ø·Ù‚ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ ---
def doctor_portal():
    st.markdown("<div class='main-title'>ğŸ‘¨â€âš•ï¸ Doctor Portal</div>", unsafe_allow_html=True)

    # 1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    if 'logged_in_doctor_id' not in st.session_state or st.session_state['logged_in_doctor_id'] is None:
        col1, col2, col3 = st.columns([1, 1.5, 1])
        with col2:
            st.subheader("Login to your account")
            with st.form("doctor_login"):
                doc_id_input = st.text_input("Enter Doctor ID (Try 001, 006, or 007)", max_chars=3)
                submitted = st.form_submit_button("Login", use_container_width=True)

                if submitted:
                    found_doc = next((d for d in st.session_state.doctors if d.doctor_id == doc_id_input), None)
                    if found_doc:
                        st.session_state['logged_in_doctor_id'] = found_doc.doctor_id
                        st.rerun()
                    else:
                        st.error("Invalid ID.")
        return

    # 2. Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
    current_doc = next(d for d in st.session_state.doctors if d.doctor_id == st.session_state['logged_in_doctor_id'])
    
    with st.sidebar:
        st.title(f"Dr. {current_doc.name}")
        st.write(f"**Specialization:** {current_doc.specialization}")
        menu = st.radio("Menu", ["ğŸ“… My Appointments", "âš™ï¸ Manage Availability", "ğŸšª Logout"])

    if menu == "ğŸ“… My Appointments":
        st.subheader("Current Appointments")
        if not st.session_state.appointments:
            st.info("No appointments found.")
        else:
            st.table(st.session_state.appointments)

    elif menu == "âš™ï¸ Manage Availability":
        st.subheader("Work Schedule")
        day = st.selectbox("Select Day", list(current_doc.schedule.keys()))
        cols = st.columns(4)
        for i in range(24):
            with cols[i % 4]:
                status = current_doc.schedule[day][i]
                if st.button(f"{i:02d}:00 - {status}", key=f"t_{i}"):
                    current_doc.schedule[day][i] = "not available" if status == "available" else "available"
                    st.rerun()

    elif menu == "ğŸšª Logout":
        st.session_state['logged_in_doctor_id'] = None
        st.rerun()

if __name__ == "__main__":
    doctor_portal()
